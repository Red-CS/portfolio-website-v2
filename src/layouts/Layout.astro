---
// Icon component
import { Icon, Logo } from '@components'

// Icons
import { FiGithub, FiInstagram, FiLinkedin } from 'react-icons/fi'
import { FaDiscord } from 'react-icons/fa'
import { LiaSpotify } from 'react-icons/lia'
import { FaXTwitter } from 'react-icons/fa6'

// Types
import type { IconProps } from '@types'

const socials: IconProps[] = [
  {
    icon: FiGithub,
    href: 'https://github.com/Red-CS/'
  },
  {
    icon: LiaSpotify,
    href: 'https://open.spotify.com/user/jpw918?si=9641a1c3c57b4e04',
    style: {
      transform: 'scale(1.4)' // Spotify logo is weird for whatever reason
    }
  },
  {
    icon: FiInstagram,
    href: ''
  },
  {
    icon: FiLinkedin,
    href: ''
  },
  {
    icon: FaXTwitter,
    href: ''
  },
  {
    icon: FaDiscord,
    href: ''
  }
]

const email = 'redpwilliams@gmail.com'

const navHeaders: { name: string; href: string }[] = [
  { name: 'Home', href: '/' },
  { name: 'Projects', href: '/projects' },
  { name: 'Reports', href: '/reports' },
  { name: 'Resume', href: '/resume' }
]

const isSubpath = (currentUrl: string, basePath: string): boolean => {
  if (currentUrl === basePath) return true
  if (basePath === '/') return false
  return currentUrl.startsWith(basePath)
}

interface Props {
  title: string
}

const { title } = Astro.props
---

<!doctype html>
<html lang='en'>
  <head>
    <meta charset='UTF-8' />
    <meta name='description' content='Astro description' />
    <meta name='viewport' content='width=device-width' />
    <link rel='icon' type='image/svg+xml' href='/favicon.svg' />
    <meta name='generator' content={Astro.generator} />
    <title>{title}</title>
    <link rel='preconnect' href='https://fonts.googleapis.com' />
    <link rel='preconnect' href='https://fonts.gstatic.com' crossorigin />
    <link
      href='https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;600;700&display=swap'
      rel='stylesheet'
    />
    <link
      rel='stylesheet'
      href='https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap'
    />
  </head>
  <body>
    <div class='main-container'>
      <aside class='socials'>
        <ul>
          {
            socials.map((social) => (
              <li style='scale: 1.3'>
                <Icon href={social.href} translateOnHover>
                  <social.icon className='icon' style={social.style} />
                </Icon>
              </li>
            ))
          }
        </ul>
      </aside>
      <nav class='main-nav'>
        <ul>
          {
            navHeaders.map((header) => (
              <li>
                <a
                  href={header.href}
                  style={{
                    color: isSubpath(Astro.url.pathname, header.href) ? 'var(--text-main)' : ''
                  }}>
                  {header.name}
                </a>
              </li>
            ))
          }
        </ul>
      </nav>
      <slot />
      <aside class='email'><div><a>{email}</a></div></aside>
    </div>
    <footer>
      <Logo />
      <p>Stay Connected</p>
      <hr />
      <div class='footer-api-wrapper'>
        <span class='api-span datetime'></span>
        <span class='api-span spotify-api'>
          <span></span>
          <span></span>
          <span></span>
          <p id='spotify-text'>Currently listening to —</p>
        </span>
        <script type='module'>
          // const footerDatetime = document.getElementsByClassName('datetime').item(0)!
          // setInterval((i) => {
          //   footerDatetime.innerHTML = 'Blacksburg, VA, • Time: ' + i++
          // }, 1000)
          // const spotify = document.getElementById('spotify-text')
          // const data = fetch('https://redwilliams.dev/api/projects', {
          //   method: 'POST',
          //   headers: {
          //     'Accept': 'application/json',
          //     'Content-Type': 'application/json'
          //   }
          // }).then((d) => console.log(d))
          function doFetch() {
            fetch('/builtwithjson').then((response) => {
              return response.json().then((data) => console.log(data))
            })
          }

          setInterval(doFetch, 5000)
        </script>
      </div>
    </footer>
  </body>
</html>
<style is:global lang='scss'>
  @use 'src/main' as *;

  :root {
    --text-main: #f4f3f2;
    --text-gray-light: #d3d3d3;
    --text-gray-dark: #a3a3a3;

    --bg-color: #1e1e1e;
    --bg-color-secondary: #171717;

    --gradient-start: rgba(255, 133, 64, 1);
    --gradient-end: rgba(255, 64, 64, 1);
    --gradient: linear-gradient(45deg, var(--gradient-start), var(--gradient-end));

    --aside-width: 6vw;

    --font-sans: Inter, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
      Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    --font-mono: 'Roboto Mono', 'Courier New', Courier, monospace;
  }
  *,
  *::before,
  *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  html {
    height: 100%;
    scroll-behavior: smooth;
    background-color: var(--bg-color-secondary);
  }

  body {
    background-size: cover;
    margin: 0;
    padding: 0;
    font-family: var(--font-sans);
    min-height: 100vh;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .main-container {
    background-color: var(--bg-color);
    flex-grow: 1;
  }

  aside,
  aside > * {
    display: none;
    color: var(--text-gray-light);
    font-family: var(--font-mono);
  }

  main {
    padding: 0 1em;
  }

  a,
  a:visited {
    color: var(--text-main);
  }

  .main-nav {
    position: fixed;
    width: 90%;
    max-width: 28rem;
    height: 3rem;
    justify-self: center;
    margin: 1rem auto;
    border: 2px solid var(--text-gray-dark);
    background-color: var(--bg-color-secondary);
    border-radius: 8px;
    background-clip: border-box;
    transition: border-color 0.2s ease;
    z-index: 10;
    left: 0;
    right: 0;

    &:hover {
      border-color: var(--text-gray-light);
    }

    ul {
      display: flex;
      align-items: center;
      justify-content: space-around;
      height: 100%;

      a {
        color: var(--text-gray-dark);
        padding: 0.8em;
        transition: color 0.2s ease;
        font-weight: 400;

        &:hover {
          color: var(--text-main);
        }
      }
    }
  }

  @media (min-width: 30em) {
    main {
      padding: 0 2em;
    }
  }

  @media (min-width: $breakpoint-main) {
    body {
      min-height: 100vh;
    }
    main {
      padding: 0 75px;
      min-height: 30vh; // TODO - Use with Footer height variable (30vh as of right now)
      max-width: 1600px;
      margin: 0 auto;
    }

    aside {
      width: var(--aside-width);
      display: block;
      overflow-y: auto;
    }

    %aside-positioned-element {
      display: inline-block;
      position: relative;
    }

    %aside-positioned-element-before {
      content: '';
      display: inline-block;
      width: 0.2vh;
      height: 15vh;
      background-color: var(--text-gray-light);
      vertical-align: middle;
      margin-bottom: 2vh;
    }

    .email {
      left: 0;
      right: auto;
      position: sticky;
      bottom: 0;
      font-size: 1.6vh;

      & > div {
        display: block;
      }

      & > div > a {
        width: 100%;
        line-height: var(--aside-width);
        writing-mode: vertical-rl;
        transform: rotate(180deg);
        @extend %aside-positioned-element;
      }

      & > div > a::before {
        @extend %aside-positioned-element-before;
      }
    }

    .socials {
      position: sticky;
      top: 0;
      float: right;
      display: initial;

      & > ul {
        width: 100%;
        display: flex;
        flex-direction: column;
        justify-content: start;
        align-items: center;
        flex-wrap: nowrap;

        & > li {
          margin: 1vh 0;
        }
      }

      & > ul::before {
        @extend %aside-positioned-element-before;
      }
    }

    .socials a,
    .socials a:visited {
      color: var(--text-gray-light);
    }
  }

  footer {
    min-height: 30vh;
    width: 100%;
    background-color: var(--bg-color-secondary);

    & > * {
      margin: 0 auto;
      display: block;
      text-align: center;
      text-transform: uppercase;
    }

    & > p {
      font-size: 1.2rem;
      letter-spacing: 4px;
      margin-bottom: 2rem;
      color: var(--text-main);
    }

    hr {
      width: 100%;
      margin: 1rem 0;
    }
  }

  .logo {
    margin: 2rem auto 1rem auto;
    scale: 0.8;
  }

  footer:hover .logo rect,
  footer:focus .logo rect {
    height: 77px;
    &.lower-level {
      height: 90px;
    }
  }

  .footer-api-wrapper {
    display: flex;
    justify-content: space-around;
  }

  .spotify-api {
    display: flex;
    align-items: center;
    font-family: var(--font-sans);
    text-transform: none;

    @keyframes spotify-playing {
      0% {
        height: 3px;
      }
      50% {
        height: 16px;
      }
      to {
        height: 3px;
      }
    }

    & > span {
      width: 4px;
      height: 16px;
      border-radius: 4px;
      background: var(--gradient);
      margin: 0 3px;

      &:nth-child(1) {
        animation: spotify-playing 0.85s infinite ease;
      }

      &:nth-child(2) {
        animation: spotify-playing 1.26s infinite ease;
      }

      &:nth-child(3) {
        animation: spotify-playing 1s infinite ease;
      }
    }

    & > p {
      margin-left: 1rem;
    }
  }
  h2 {
    color: var(--text-main);
    font-size: 1rem;
  }

  h3 {
    color: var(--text-main);
    font-size: 2rem;
    font-weight: 500;
  }

  p {
    color: var(--text-gray-light);
    font-size: 1rem;
    line-height: 1.8;
  }

  a {
    text-decoration: none;
  }

  ul {
    list-style: none;
  }

  code {
    font-family:
      Menlo,
      Monaco,
      Lucida Console,
      Liberation Mono,
      DejaVu Sans Mono,
      Bitstream Vera Sans Mono,
      Courier New,
      monospace;
  }
</style>
